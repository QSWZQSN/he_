use master
if exists(select * from sys.databases where name='cs171')
	drop database cs171
create database cs171
go
use cs171

create table  xueSen
(
	xueHao  char(12) primary key,
	xinMin nvarchar(3) not null,
	xinBie bit default 0,
	senGao int ,
	tiZong decimal(3,1),
	senRi datetime,
	jianLi ntext,
)
create table keCen
(
	ID char(8) primary key,
	keCen nvarchar(9) not null,
	keSi int default 64,
	xueFen int default 4,
)
create table cenJi
(
	ID int identity primary key,
	xueHao  char(12) foreign key references xueSen(XueHao),
	keCenID char(8) foreign key references KeCen(ID),
	cenJi tinyInt default 0,
)

insert  into  keCen(id,keCen,keSi,xueFen)   values('10500023','大学英语',64,2)
insert  into  keCen(ID,keCen,keSi,xueFen)	values('11100036','体育俱乐部',32,1)
insert  into  keCen(ID,keCen,keSi,xueFen)	values('11900045','马克思基本原理概论',48,3)
insert  into  keCen(ID,keCen,keSi,xueFen)	values('14108033','离散数学',64,4)
insert  into  keCen(ID,keCen,keSi,xueFen)	values('14108199','数字电路与数字逻辑',96,4)
insert  into  keCen(ID,keCen,keSi,xueFen)	values('14108047','面向对象程序设计',48,5)
insert  into  keCen(ID,keCen,keSi,xueFen)	values('14108198','编译原理',80,3)

insert  into  xueSen(xueHao,xinMin,xinBie,senGao,tiZong,senRi) values('201742010123 ','韦婷婷',0,165,46.5,'2001-9-9')
,('201742010119','周永瑶',0,154,50,'1999-09-02')
,('201742010121','聂仲秋',1,170,60.5,'1996-04-05')
,('201610100132','张林东',1,170,55,'1996-01-15')    
,('201742010101','彭纯熙',1,170,80,'1998-08-31')
,('201742010102','王蓉华',0,163,55,'1997-07-10')
,('201742010104','杨洋',0,160,48.5,'1995-5-30')
,('201742010109','卢奕行',0,155,44,'1998-5-24')
,('201742010116','龙家铭',1,160,60.5,'1999-01-01' )
,('201742010111','刘梓恒',1,170,58.5,'1998-6-22')
,('201742010110','杨山',1,175,70.5,'1999-02-21' )
,('201742010142','沈先倩',0,160,54,'1997-09-18')
,('201742010139','黄祥',1,165,50.1,'1998-12-6')
,('201742010138','陈纪宏',1,168,53.0,'2000-11-19')
,('201742010136','邓申杰',1,170,62,'2000-11-19')
,('201742010135','黄强',1,168,50,'1999-04-27')
,('201742010133','田依婷',0,163 ,50 ,'1997-10-15')
,('201742010130','任晨曦',0,150,50.0,'1999-06-14')
,('201742010129','杨文倩',0,157,55,'1998-2-21')
,('201742010124','杨立请',1,162,45.0,'1998-01-14')
,('201742010144','罗斯文',1,166,50,'1998-04-11')
,('201742010209','胡任泰',1 ,176,69,'1998-03-18')
,('201742010208','伍明思',0,156,46,'1998-8-18')
,('201742010205','陈悦',0,155,50,'1997-11-1')
,('201742010204','伍倩',0,158,45,'1998-12-6')
,('201742010156','盘金梅',0,161,56.9,'2001-9-17')
,('201742010202','韩渝琳',0,162,48.5,'1998-7-14')
,('201742010161','涂美松',1,175,60.5,'1998-09-15' )
,('201742010160','叶立春',0,156,53,'1997-10-07')
,('201742010155','吴沁玫',0,150,45.5,'1998-09-01')
,('201742010149','何璇',1,171,76,'1997-04-01')
,('201742010145','郑丹',0,163 ,48.5 ,'1997-12-15')
,('201742010210','罗丽娟',0,155,50,'1997-11-27')
,('201742010245','李兴禾',1,168,67.6,'1998-12-16')
,('201742010243','何院',0,160,55,'1997-9-27')

insert  into  xueSen(xueHao,xinMin,xinBie,senGao,tiZong,senRi) values
  ('201742010240','张剑旭',1,160,46,'2000-05-03')
 ,('201742010239','费昭福',1,170,55,'1997-10-07')
 ,('201742010236','余洋',1,178,90,'1997-03-06')
 ,('201742010229','王定贵',1,156,48,'1997-03-06')
 ,('201742010222','覃运司',0,152,37,'1999-1-10')
 ,('201742010221','田甜',0,167,48.5,'1998-12-5')
 ,('201742010220','杨再良',1,170,65,'1997-01-15')
 ,('201742010218','谢云飚',1,173,65,'1997-09-01')
 ,('201742010217','龙华智',1,170,58,'1999-9-3')
 ,('201742010216','徐雷雨',1,170,55,'1997-12-08')
 ,('201742010215','吴诗兰',1,170,75,'1999-07-04')
 ,('201742010211','黄瀚铖',1,175,33,'1999-07-04')
 ,('201742010141','沈先术',0,150,48.5,'1997-11-29')
 
insert  into  xueSen(xueHao,xinMin,xinBie,senGao,tiZong,senRi) values
  ('201742010260','付安',1,165,50,'1999-07-04')
 ,('201742010259','陈贵香',1,160,50,'1998-7-14')
 ,('201742010257','杨朝配',1,172,64,'1997-10-05')
 ,('201742010256','王光迁',1,173,65.5,'1998-07-24')
 ,('201742010255','邓莲飘',1,160,50,'1997-10-08')
 ,('201742010254','龚敬',0,156,50,'1997-1-22')
 ,('201742010253','李雪飞',1,178,65,'1999-01-15')
 ,('201742010252','韦兴先',1,171,52,'1998-10-7' )
 ,('201742010249','康圣侠',1,164,60,'1998-10-7')
 ,('201742010246','李春',0,172,72,'1999-02-21')
insert  into  xueSen(xueHao,xinMin,xinBie,senGao,tiZong,senRi) values
('201942010134','邓丁',0,170,61,'1997-12-04')
,('201942010130','雷茂',1,165,49.5,'1997-1-21')
,('201942010126','夏跃成',1,170,60,'1996-11-09')
,('201942010124','陈文',0,170,55,'1996-03-06')
,('201942010119','雷启松',1,180,70,'1997-11-29')
,('201942010115','吕德银',1,173,65,'1998-02-11')
,('201942010108','李明阳',1,170,56,'1998-02-08')
,('201942010107','陈缘',0,163,55,'1996-08-15')
,('201942010104','周松',1,165,55,'1997-07-16')
,('201744010210','龙瑞波',1,180,70,'1996-08-15')
,('201743010130','张蔷莘',0,160,50,'1997-09-18')
,('201742010262','杨文娟',0,158,45,'1997-10-30')
,('201742010261','杨贤军',1,164,60,'1997-10-30')
insert into  cenJi(xueHao,keCenID,cenJi) values('201742010123','10500023',89)
insert into  cenJi(xueHao,keCenID,cenJi) values('201742010123','11100036',84)
insert into  cenJi(xueHao,keCenID,cenJi) values('201742010123','11900045',87)
insert into  cenJi(xueHao,keCenID,cenJi) values('201742010123','14108033',85)
insert into  cenJi(xueHao,keCenID,cenJi) values('201742010123','14108199',74)
insert into  cenJi(xueHao,keCenID,cenJi) values('201742010123','14108047',99)
insert into  cenJi(xueHao,keCenID,cenJi) values('201742010123','14108198',93)
,('201742010119','10500023',87),('201742010119','11100036',82),('201742010119','11900045',72),('201742010119','14108033',81),('201742010119','14108047',88),('201742010119','14108198',81),('201742010119','14108199',87)
,('201742010121','10500023',76),('201742010121','11100036',83),('201742010121','11900045',63),('201742010121','14108033',65),('201742010121','14108047',81),('201742010121','14108198',75),('201742010121','14108199',55)
,('201610100132','10500023',65),('201610100132','11100036',80),('201610100132','11900045',65),('201610100132','14108033',70),('201610100132','14108047',67),('201610100132','14108198',75),('201610100132','14108199',73)
,('201742010101','10500023',86),('201742010101','11100036',82),('201742010101','11900045',74),('201742010101','14108033',60),('201742010101','14108047',83),('201742010101','14108198',71),('201742010101','14108199',77)
,('201742010102','10500023',88),('201742010102','11100036',79),('201742010102','11900045',86),('201742010102','14108033',60),('201742010102','14108047',94),('201742010102','14108198',93),('201742010102','14108199',79)
,('201742010104','10500023',81),('201742010104','11100036',81),('201742010104','11900045',81),('201742010104','14108033',81),('201742010104','14108047',81),('201742010104','14108198',81),('201742010104','14108199',81)
,('201742010109','10500023',91),('201742010109','11100036',83),('201742010109','11900045',71),('201742010109','14108033',77),('201742010109','14108047',97),('201742010109','14108198',81),('201742010109','14108199',84)
,('201742010116','10500023',72),('201742010116','11100036',83),('201742010116','11900045',79),('201742010116','14108033',54),('201742010116','14108047',72),('201742010116','14108198',60),('201742010116','14108199',71)
,('201742010111','10500023',76),('201742010111','11100036',85),('201742010111','11900045',74),('201742010111','14108033',75),('201742010111','14108047',88),('201742010111','14108198',81),('201742010111','14108199',75)
,('201742010110','10500023',75),('201742010110','11100036',75),('201742010110','11900045',71),('201742010110','14108033',65),('201742010110','14108047',78),('201742010110','14108198',65),('201742010110','14108199',69)

,('201742010142','10500023',80),('201742010142','11100036',83),('201742010142','11900045',71),('201742010142','14108033',93),('201742010142','14108047',95),('201742010142','14108198',81),('201742010142','14108199',83)
,('201742010139','10500023',60),('201742010139','11100036',61),('201742010139','11900045',62),('201742010139','14108033',63),('201742010139','14108047',64),('201742010139','14108198',65),('201742010139','14108199',66)
,('201742010138','10500023',77),('201742010138','11100036',80),('201742010138','11900045',65),('201742010138','14108033',85),('201742010138','14108047',85),('201742010138','14108198',71),('201742010138','14108199',77)
,('201742010136','10500023',82),('201742010136','11100036',79),('201742010136','11900045',61),('201742010136','14108033',78),('201742010136','14108047',64),('201742010136','14108198',93),('201742010136','14108199',68)
,('201742010135','10500023',29),('201742010135','11100036',18),('201742010135','11900045',33),('201742010135','14108033',44),('201742010135','14108047',55),('201742010135','14108198',39),('201742010135','14108199',48)
,('201742010133','10500023',82),('201742010133','11100036',92),('201742010133','11900045',71),('201742010133','14108033',87),('201742010133','14108047',90),('201742010133','14108198',93),('201742010133','14108199',75)
,('201742010130','10500023',85),('201742010130','11100036',78),('201742010130','11900045',78),('201742010130','14108033',91),('201742010130','14108047',95),('201742010130','14108198',93),('201742010130','14108199',89)
,('201742010129','10500023',89),('201742010129','11100036',80),('201742010129','11900045',82),('201742010129','14108033',84),('201742010129','14108047',90),('201742010129','14108198',81),('201742010129','14108199',74)
,('201742010124','10500023',70),('201742010124','11100036',85),('201742010124','11900045',68),('201742010124','14108033',85),('201742010124','14108047',85),('201742010124','14108198',71),('201742010124','14108199',78)
,('201742010144','10500023',80),('201742010144','11100036',85),('201742010144','11900045',73),('201742010144','14108033',71),('201742010144','14108047',89),('201742010144','14108198',74),('201742010144','14108199',71)

,('201742010209','10500023',68),('201742010209','11100036',70),('201742010209','11900045',84),('201742010209','14108033',69),('201742010209','14108047',74),('201742010209','14108198',76),('201742010209','14108199',63)
,('201742010208','10500023',86),('201742010208','11100036',81),('201742010208','11900045',87),('201742010208','14108033',87),('201742010208','14108047',96),('201742010208','14108198',93),('201742010208','14108199',85)
,('201742010205','10500023',80),('201742010205','11100036',80),('201742010205','11900045',65),('201742010205','14108033',31),('201742010205','14108047',58),('201742010205','14108198',75),('201742010205','14108199',75)
,('201742010204','10500023',85),('201742010204','11100036',82),('201742010204','11900045',63),('201742010204','14108033',66),('201742010204','14108047',86),('201742010204','14108198',81),('201742010204','14108199',69)
,('201742010156','10500023',84),('201742010156','11100036',91),('201742010156','11900045',71),('201742010156','14108033',58),('201742010156','14108047',76),('201742010156','14108198',84),('201742010156','14108199',93)
,('201742010202','10500023',91),('201742010202','11100036',95),('201742010202','11900045',90),('201742010202','14108033',95),('201742010202','14108047',86),('201742010202','14108198',93),('201742010202','14108199',86)
,('201742010161','10500023',70),('201742010161','11100036',85),('201742010161','11900045',73),('201742010161','14108033',65),('201742010161','14108047',78),('201742010161','14108198',65),('201742010161','14108199',75)
,('201742010160','10500023',87),('201742010160','11100036',82),('201742010160','11900045',82),('201742010160','14108033',86),('201742010160','14108047',89),('201742010160','14108198',81),('201742010160','14108199',78)
,('201742010155','10500023',73),('201742010155','11100036',84),('201742010155','11900045',73),('201742010155','14108033',65),('201742010155','14108047',78),('201742010155','14108198',65),('201742010155','14108199',75)
,('201742010149','10500023',76),('201742010149','11100036',85),('201742010149','11900045',72),('201742010149','14108033',28),('201742010149','14108047',73),('201742010149','14108198',71),('201742010149','14108199',71)
,('201742010145','10500023',77),('201742010145','11100036',86),('201742010145','11900045',68),('201742010145','14108033',60),('201742010145','14108047',80),('201742010145','14108198',93),('201742010145','14108199',70)
,('201742010210','10500023',85),('201742010210','11100036',88),('201742010210','11900045',63),('201742010210','14108033',71),('201742010210','14108047',81),('201742010210','14108198',78),('201742010210','14108199',78)
insert into  cenJi(xueHao,keCenID,cenJi) values
 ('201742010245','10500023',76),('201742010245','11100036',80),('201742010245','11900045',64),('201742010245','14108033',85),('201742010245','14108047',67),('201742010245','14108198',81),('201742010245','14108199',78)
,('201742010243','10500023',86),('201742010243','11100036',83),('201742010243','11900045',74),('201742010243','14108033',81),('201742010243','14108047',79),('201742010243','14108198',71),('201742010243','14108199',74)
,('201742010240','10500023',81),('201742010240','11100036',91),('201742010240','11900045',71),('201742010240','14108033',33),('201742010240','14108047',90),('201742010240','14108198',71),('201742010240','14108199',75)
,('201742010239','10500023',82),('201742010239','11100036',60),('201742010239','11900045',61),('201742010239','14108033',60),('201742010239','14108047',64),('201742010239','14108198',61),('201742010239','14108199',69)
,('201742010236','10500023',76),('201742010236','11100036',76),('201742010236','11900045',79),('201742010236','14108033',34),('201742010236','14108047',64),('201742010236','14108198',61),('201742010236','14108199',74)
,('201742010220','10500023',85),('201742010220','11100036',77),('201742010220','11900045',72),('201742010220','14108033',76),('201742010220','14108047',79),('201742010220','14108198',83),('201742010220','14108199',71)
,('201742010218','10500023',90),('201742010218','11100036',90),('201742010218','11900045',90),('201742010218','14108033',90),('201742010218','14108047',90),('201742010218','14108198',90),('201742010218','14108199',90)
,('201742010221','10500023',89),('201742010221','11100036',91),('201742010221','11900045',82),('201742010221','14108033',69),('201742010221','14108047',83),('201742010221','14108198',81),('201742010221','14108199',71)
,('201742010217','10500023',77),('201742010217','11100036',90),('201742010217','11900045',60),('201742010217','14108033',59),('201742010217','14108047',68),('201742010217','14108198',71),('201742010217','14108199',69)
,('201742010216','10500023',30),('201742010216','11100036',89),('201742010216','11900045',65),('201742010216','14108033',70),('201742010216','14108047',60),('201742010216','14108198',77),('201742010216','14108199',67)
,('201742010215','10500023',85),('201742010215','11100036',85),('201742010215','11900045',65),('201742010215','14108033',72),('201742010215','14108047',84),('201742010215','14108198',80),('201742010215','14108199',74)
,('201742010211','10500023',85),('201742010211','11100036',77),('201742010211','11900045',72),('201742010211','14108033',76),('201742010211','14108047',79),('201742010211','14108198',83),('201742010211','14108199',71)
insert into  cenJi(xueHao,keCenID,cenJi) values
 ('201742010260','10500023',83),('201742010260','11100036',84),('201742010260','11900045',61),('201742010260','14108033',35),('201742010260','14108047',65),('201742010260','14108198',81),('201742010260','14108199',60)
,('201742010259','10500023',90),('201742010259','11100036',90),('201742010259','11900045',90),('201742010259','14108033',90),('201742010259','14108047',90),('201742010259','14108198',90),('201742010259','14108199',90)
,('201742010257','10500023',76),('201742010257','11100036',75),('201742010257','11900045',65),('201742010257','14108033',84),('201742010257','14108047',68),('201742010257','14108198',82),('201742010257','14108199',67)
,('201742010256','10500023',84),('201742010256','11100036',92),('201742010256','11900045',82),('201742010256','14108033',25),('201742010256','14108047',79),('201742010256','14108198',71),('201742010256','14108199',77)
,('201742010255','10500023',85),('201742010255','11100036',82),('201742010255','11900045',82),('201742010255','14108033',84),('201742010255','14108047',75),('201742010255','14108198',93),('201742010255','14108199',78)
,('201742010254','10500023',84),('201742010254','11100036',81),('201742010254','11900045',75),('201742010254','14108033',94),('201742010254','14108047',90),('201742010254','14108198',93),('201742010254','14108199',83)
,('201742010253','10500023',88),('201742010253','11100036',92),('201742010253','11900045',65),('201742010253','14108033',80),('201742010253','14108047',75),('201742010253','14108198',82),('201742010253','14108199',82)
,('201742010252','10500023',70),('201742010252','11100036',85),('201742010252','11900045',73),('201742010252','14108033',65),('201742010252','14108047',78),('201742010252','14108198',65),('201742010252','14108199',75)
,('201742010249','10500023',74),('201742010249','11100036',79),('201742010249','11900045',71),('201742010249','14108033',89),('201742010249','14108047',93),('201742010249','14108198',81),('201742010249','14108199',78)
,('201742010246','10500023',77),('201742010246','11100036',86),('201742010246','11900045',67),('201742010246','14108033',60),('201742010246','14108047',65),('201742010246','14108198',82),('201742010246','14108199',70)
insert into  cenJi(xueHao,keCenID,cenJi) values
 ('201942010134','10500023',87),('201942010134','11100036',86),('201942010134','11900045',87),('201942010134','14108033',85),('201942010134','14108047',80),('201942010134','14108198',86),('201942010134','14108199',98)
,('201942010130','10500023',80),('201942010130','11100036',83),('201942010130','11900045',87),('201942010130','14108033',77),('201942010130','14108047',78),('201942010130','14108198',90),('201942010130','14108199',81)
,('201942010126','10500023',80),('201942010126','11100036',86),('201942010126','11900045',87),('201942010126','14108033',85),('201942010126','14108047',80),('201942010126','14108198',86),('201942010126','14108199',98)
,('201942010124','10500023',80),('201942010124','11100036',86),('201942010124','11900045',87),('201942010124','14108033',80),('201942010124','14108047',86),('201942010124','14108198',80),('201942010124','14108199',90)
,('201942010119','10500023',80),('201942010119','11100036',86),('201942010119','11900045',87),('201942010119','14108033',85),('201942010119','14108047',80),('201942010119','14108198',86),('201942010119','14108199',98)
,('201942010115','10500023',85),('201942010115','11100036',85),('201942010115','11900045',85),('201942010115','14108033',85),('201942010115','14108199',85),('201942010115','14108047',85),('201942010115','14108198',85)
,('201942010108','10500023',80),('201942010108','11100036',86),('201942010108','11900045',87),('201942010108','14108033',85),('201942010108','14108047',80),('201942010108','14108198',86),('201942010108','14108199',98)
,('201942010107','10500023',80),('201942010107','11100036',86),('201942010107','11900045',87),('201942010107','14108033',85),('201942010107','14108047',80),('201942010107','14108198',86),('201942010107','14108199',98)
,('201942010104','10500023',80),('201942010104','11100036',86),('201942010104','11900045',87),('201942010104','14108033',85),('201942010104','14108047',80),('201942010104','14108198',86),('201942010104','14108199',98)
,('201744010210','10500023',87),('201744010210','11100036',87),('201744010210','11900045',79),('201744010210','14108033',67),('201744010210','14108047',95),('201744010210','14108198',71),('201744010210','14108199',80)
,('201743010130','10500023',82),('201743010130','11100036',84),('201743010130','11900045',71),('201743010130','14108033',93),('201743010130','14108047',95),('201743010130','14108198',71),('201743010130','14108199',74)
,('201742010262','10500023',87),('201742010262','11100036',82),('201742010262','11900045',60),('201742010262','14108033',78),('201742010262','14108047',84),('201742010262','14108198',83),('201742010262','14108199',71)
,('201742010261','10500023',73),('201742010261','11100036',79),('201742010261','11900045',60),('201742010261','14108033',61),('201742010261','14108047',64),('201742010261','14108198',83),('201742010261','14108199',65)
,('201742010141','10500023',89),('201742010141','11100036',80),('201742010141','11900045',82),('201742010141','14108033',84),('201742010141','14108199',78),('201742010141','14108047',88),('201742010141','14108198',81)
go
create view vXueSen
as
select xueHao as 学号,xinMin 姓名
,case when xinBie=1 then '男' else '女' end 性别
,senGao 身高,tiZong 体重
,cast(senRi as char(10)) 生日 from xueSen
go
create view vKeCen
as
   select ID 课程编码,keCen 课程,xueFen 学分,keSi 学时 from keCen

go
create view vCenji
as
  select a.xueHao 学号,b.xinMin 姓名
  ,'['+c.ID+']'+c.keCen 课程,a.cenJi 成绩 
  ,case when a.cenJi>=60 then C.xueFen else 0 end 学分
  from cenJi a join xueSen b on a.xueHao=b.xueHao
  join keCen c on a.keCenID=c.ID
go
select * from vXueSen
select * from vCenji
select * from vKeCen

select 学号,max(姓名) xm,count(*) 数量,avg(成绩) 平均 from vCenji  group by 学号